<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾¤èŠæŠ¥å‘Š</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- å¼•å…¥æ‰‹å†™å­—ä½“å’Œæ­£æ–‡é˜…è¯»å­—ä½“ -->
    <link
        href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Long+Cang&family=Noto+Sans+SC:wght@400;500;700&family=Patrick+Hand&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{templateDir}}style.css">
</head>

<body>
    <div class="container">

        <!-- 1. Header -->
        <div class="header">
            <div class="title-sticker">
                <div class="tape"></div>
                <h1>äº”å½©æ–‘æ–“çš„ä¸€å¤©,æ¥çœ‹çœ‹ç¾¤é‡Œå‘ç”Ÿäº†ä»€ä¹ˆå§! </h1>
                <div class="date-badge">{{dateRange}}</div>
            </div>
        </div>

        <!-- 2. Statistics Stamps and Peak Activity -->
        <div class="grid-layout" style="margin-bottom: 40px;">
            <!-- Statistics Stamps -->
            <div class="stats-section" style="grid-column: span 8;">
                <div class="stats-row">
                    <div class="stamp" style="transform: rotate(-3deg);">
                        <div class="stamp-inner">
                            <div class="stamp-label">æ¶ˆæ¯æ•°</div>
                            <div class="stamp-num">{{totalMessages}}</div>
                        </div>
                    </div>
                    <div class="stamp" style="transform: rotate(2deg);">
                        <div class="stamp-inner">
                            <div class="stamp-label">å‚ä¸è€…</div>
                            <div class="stamp-num">{{totalUsers}}</div>
                        </div>
                    </div>
                    <div class="stamp" style="transform: rotate(-1deg);">
                        <div class="stamp-inner">
                            <div class="stamp-label">å­—ç¬¦æ•°</div>
                            <div class="stamp-num">{{totalChars}}</div>
                        </div>
                    </div>
                    <div class="stamp" style="transform: rotate(4deg);">
                        <div class="stamp-inner">
                            <div class="stamp-label">è¡¨æƒ…æ•°</div>
                            <div class="stamp-num">{{totalEmojis}}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Peak Activity Period -->
            <div class="highlight-section" style="grid-column: span 4;">
                <div class="tape-top"></div>
                <div class="section-title" style="font-size: 0.9rem; color: var(--ink-secondary);">æœ€æ´»è·ƒæ—¶æ®µ</div>
                <div class="time-big">{{peakPeriod}}</div>
                <div class="time-desc">ï¼ˆæ­¤åˆ»ï¼Œç¾¤èŠç¾¤æ˜Ÿç’€ç’¨ï¼‰</div>
            </div>
        </div>

        <div class="grid-layout">

            <!-- 3. 24-Hour Activity Chart -->
            <div class="chart-section" style="grid-column: span 12;">
                <div class="coil"></div>
                <div class="section-title">
                    <svg class="doodle" viewBox="0 0 24 24">
                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                    </svg>
                    24å°æ—¶æ´»è·ƒåº¦ Hourly Activity
                </div>
                {{if enableActivityChart && activityChart}}
                {{each activityChart.hours hourData}}
                <div class="hand-chart-row">
                    <div class="chart-label">{{hourData.hour < 10 ? '0' + hourData.hour : hourData.hour}}:00</div>
                    <div class="chart-bar-box">
                        <div class="crayon-bar" style="width: {{hourData.count === 0 ? '2%' : hourData.heightPercent + '%'}}; background: {{hourData.count === 0 ? 'var(--color-purple)' : (hourData.heightPercent >= 70 ? 'var(--accent-orange)' : (hourData.heightPercent >= 30 ? 'var(--color-green)' : 'var(--color-blue)'))}}"></div>
                    </div>
                    <div style="margin-left: 10px; font-size: 0.7rem; font-family: var(--font-hand); color: var(--ink-secondary); min-width: 30px;">
                        {{hourData.count}}
                    </div>
                </div>
                {{/each}}
                {{/if}}
            </div>

            <!-- 4. Today's Topics -->
            {{if topics && topics.length > 0}}
            <div class="topic-section">
                <div class="paper-holes">
                    <div class="hole"></div>
                    <div class="hole"></div>
                    <div class="hole"></div>
                </div>
                <div class="section-title">
                    <svg class="doodle" viewBox="0 0 24 24">
                        <path d="M14 17H4v2h10v-2zm6-8H4v2h16V9zM4 15h16v-2H4v2zM4 5v2h16V5H4z" />
                    </svg>
                    ä»Šæ—¥è¯é¢˜ Topics
                </div>
                {{each topics topic index}}
                <div class="topic-item">
                    <div class="check-box">
                        <div class="check-tick"></div>
                    </div>
                    <div class="topic-content">
                        <div style="display: flex; align-items: baseline; gap: 10px; margin-bottom: 8px;">
                            <span class="topic-title">{{topic.topic}}</span>
                            <span style="font-size: 0.85em; color: #999; font-family: var(--font-body);">#{{index < 9 ? '0' + (index + 1) : (index + 1)}}</span>
                        </div>
                        {{if topic.contributors && topic.contributors.length > 0}}
                        <div style="font-family: var(--font-hand); font-size: 1.05em; color: var(--ink-secondary); margin-bottom: 8px;">
                            ğŸ™‹â€â™€ï¸ å‚ä¸è€…: {{each topic.contributors contributor contributorIndex}}{{if contributorIndex > 0}}ã€{{/if}}{{contributor.nickname}}{{/each}}
                        </div>
                        {{/if}}
                        <div class="topic-detail">{{topic.detail}}</div>
                    </div>
                </div>
                {{/each}}
            </div>
            {{/if}}

            <!-- 5. User Portraits -->
            {{if userTitles && userTitles.length > 0}}
            <div class="user-section">
                <div class="section-title" style="justify-content: center;">
                    <svg class="doodle" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                    ç¾¤å‹ç”»åƒ Portraits
                </div>
                <div class="masonry-grid">
                    {{each userTitles title}}
                    <div class="user-card">
                        <div class="card-tape"></div>
                        <div class="user-header">
                            <div class="u-avatar">
                                {{if title.user_id}}
                                <img src="https://q1.qlogo.cn/g?b=qq&nk={{title.user_id}}&s=100" alt="{{title.user}}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'">
                                {{else}}
                                <svg class="doodle" style="font-size: 2rem;" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                                {{/if}}
                            </div>
                            <div class="u-info">
                                <div class="u-name">{{title.user}}</div>
                                <div class="badges">
                                    <span class="badge title">{{title.title}}</span>
                                    <span class="badge mbti">{{title.mbti}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="u-reason">
                            {{title.reason}}
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
            {{/if}}

            <!-- 6. Daily Echoes (Golden Quotes) -->
            {{if goldenQuotes && goldenQuotes.length > 0}}
            <div class="quotes-section">
                <div class="section-title" style="justify-content: center;">
                    <svg class="doodle" viewBox="0 0 24 24">
                        <path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z" />
                    </svg>
                    ç¾¤è´¤æ¯•è‡³ Bible Quotes
                </div>
                {{each goldenQuotes quote}}
                <div class="quote-wrapper">
                    <div class="q-bubble">
                        <div class="q-quote-mark">"</div>
                        <div class="q-content">{{quote.quote}}</div>
                        <div class="q-author">â€” {{quote.sender.nickname}}</div>
                    </div>
                    <div class="q-analysis-note">
                        <span class="note-label">ğŸ¤£ğŸ‘‰ AI é”è¯„:</span>
                        {{quote.reason}}
                    </div>
                </div>
                {{/each}}
            </div>
            {{/if}}

        </div>

        <!-- Footer -->
        <div class="footer">
            <p>æœ¬æŠ¥å‘Šæ ¹æ®Little AIå¿ƒæƒ…ç”Ÿæˆ,çœ‹ä¸€ä¸‹å°±å¥½</p>
            {{if tokenUsage}}
            <p style="font-size: 0.9rem; margin-top: 5px;">Token ä½¿ç”¨: Prompt {{tokenUsage.prompt}} + Completion {{tokenUsage.completion}} = Total {{tokenUsage.total}}</p>
            {{/if}}
            <p style="margin-top: 10px; font-size: 0.95rem;">{{createTime}}</p>
            <p style="font-size: 1.2rem;">TRSS-Yunzai Â· Group-Insight Â· æ—¶å£¹ with â™¡</p>
        </div>

    </div>
</body>

</html>
