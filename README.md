# ç¾¤èŠæ´è§æ’ä»¶ (Group Insight)

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Yunzai ç¾¤èŠåˆ†ææ’ä»¶ï¼Œæä¾› AI é©±åŠ¨çš„æ·±åº¦æ´å¯Ÿã€è¯äº‘ç”Ÿæˆå’Œæ¶ˆæ¯è¿½è¸ªåŠŸèƒ½ã€‚

## æ ¸å¿ƒåŠŸèƒ½

- ğŸ¤– **AI æ™ºèƒ½åˆ†æ** - è¯é¢˜æå–ã€é‡‘å¥è¯†åˆ«ã€ç”¨æˆ·ç§°å·ã€MBTI æ€§æ ¼åˆ†æ
- ğŸ“Š **æ•°æ®å¯è§†åŒ–** - æ´»è·ƒåº¦çƒ­åŠ›å›¾ã€ç»Ÿè®¡æŠ¥å‘Šã€ç²¾ç¾å¡ç‰‡å±•ç¤º
- â˜ï¸ **è¯äº‘ç”Ÿæˆ** - æ™ºèƒ½ä¸­æ–‡åˆ†è¯ã€ç²¾ç¾æ¸å˜è®¾è®¡
- ğŸ“Œ **@æ¶ˆæ¯è¿½è¸ª** - è‡ªåŠ¨è®°å½•è‰¾ç‰¹æ¶ˆæ¯ã€æ”¯æŒä¸Šä¸‹æ–‡æŸ¥çœ‹

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd plugins/group-insight
pnpm install
```

### 2. é…ç½® API Key

åˆ›å»ºé…ç½®æ–‡ä»¶ `../../config/config/group-insight.yaml`:

```yaml
groupManager:
  ai:
    # å¿…å¡«ï¼šAI API Key
    apiKey: 'your-api-key-here'

    # å¯é€‰ï¼šæä¾›å•† (claude æˆ– openai)
    provider: 'claude'

    # å¯é€‰ï¼šæ¨¡å‹åç§°
    model: 'claude-haiku-4-5'
```

### 3. é‡å¯ Yunzai

```bash
pnpm restart
```

## å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | è¯´æ˜ | æƒé™ |
|------|------|------|
| `#ç¾¤èŠæŠ¥å‘Š` | ç”Ÿæˆä»Šå¤©çš„ AI åˆ†ææŠ¥å‘Š | æ‰€æœ‰äºº |
| `#ç¾¤èŠæŠ¥å‘Š æ˜¨å¤©` | ç”Ÿæˆæ˜¨å¤©çš„æŠ¥å‘Š | æ‰€æœ‰äºº |
| `#ç¾¤èŠæŠ¥å‘Š 2024-11-01` | ç”ŸæˆæŒ‡å®šæ—¥æœŸæŠ¥å‘Š | æ‰€æœ‰äºº |
| `#å¼ºåˆ¶ç”ŸæˆæŠ¥å‘Š` | å¼ºåˆ¶ç”ŸæˆæŠ¥å‘Š(å¿½ç•¥å†·å´) | ä¸»äºº |
| `#è¯äº‘` / `#ç¾¤èŠè¯äº‘` | ç”Ÿæˆä»Šå¤©çš„è¯äº‘ | æ‰€æœ‰äºº |
| `#è¯äº‘ ä¸‰å¤©` | ç”Ÿæˆä¸‰å¤©è¯äº‘ | æ‰€æœ‰äºº |
| `#è¯äº‘ ä¸ƒå¤©` | ç”Ÿæˆä¸ƒå¤©è¯äº‘ | æ‰€æœ‰äºº |
| `è°è‰¾ç‰¹æˆ‘` / `è°@æˆ‘` | æŸ¥çœ‹è°è‰¾ç‰¹äº†ä½  | æ‰€æœ‰äºº |
| `#æ¸…é™¤è‰¾ç‰¹æ•°æ®` | æ¸…é™¤è‡ªå·±çš„è‰¾ç‰¹è®°å½• | æ‰€æœ‰äºº |
| `#æ¸…é™¤å…¨éƒ¨è‰¾ç‰¹æ•°æ®` | æ¸…é™¤æ‰€æœ‰è‰¾ç‰¹è®°å½• | ä¸»äºº |

## AI åˆ†ææŠ¥å‘Šå†…å®¹

ç”Ÿæˆçš„æŠ¥å‘ŠåŒ…å«ä»¥ä¸‹æ¨¡å—:

- **åŸºç¡€ç»Ÿè®¡** - æ¶ˆæ¯æ•°ã€å‚ä¸äººæ•°ã€å­—ç¬¦ç»Ÿè®¡ã€è¡¨æƒ…ç»Ÿè®¡
- **æ´»è·ƒåº¦åˆ†æ** - 24å°æ—¶æ´»è·ƒåº¦çƒ­åŠ›å›¾ã€å³°å€¼æ—¶æ®µ
- **è¯é¢˜æå–** - 3-5ä¸ªä¸»è¦è®¨è®ºè¯é¢˜åŠå‚ä¸è€…
- **é‡‘å¥è¯†åˆ«** - 3-5æ¡ç²¾é€‰æœ‰è¶£/éœ‡æ’¼è¯­å¥
- **ç”¨æˆ·ç§°å·** - åŸºäºè¡Œä¸ºæ¨¡å¼åˆ†é…åˆ›æ„ç§°å· + MBTI
- **Token ç»Ÿè®¡** - AI ä½¿ç”¨æƒ…å†µè¿½è¸ª

## æ ¸å¿ƒé…ç½®

åœ¨ `config/config/group-insight.yaml` ä¸­å¯è‡ªå®šä¹‰:

```yaml
groupManager:
  # æ¶ˆæ¯ä¿ç•™å¤©æ•°
  retentionDays: 7

  # è‰¾ç‰¹è®°å½•ä¿ç•™æ—¶é—´(å°æ—¶)
  atRetentionHours: 24

  # AI é…ç½®
  ai:
    apiKey: ''              # API Key (å¿…å¡«)
    provider: 'claude'      # æä¾›å•†: claude / openai
    model: 'claude-haiku-4-5'  # æ¨¡å‹åç§°
    baseURL: ''             # è‡ªå®šä¹‰ç«¯ç‚¹(å¯é€‰)
    maxTokens: 20000        # æœ€å¤§ Token

  # AI åˆ†æå¼€å…³
  analysis:
    topic:
      enabled: true         # è¯é¢˜åˆ†æ
      max_topics: 5
    goldenQuote:
      enabled: true         # é‡‘å¥æå–
      max_golden_quotes: 5
    userTitle:
      enabled: true         # ç”¨æˆ·ç§°å·
      max_user_titles: 8
    activity:
      enabled: true         # æ´»è·ƒåº¦å›¾è¡¨
    min_messages_threshold: 20  # æœ€å°‘æ¶ˆæ¯æ•°(ä½äºæ­¤æ•°è·³è¿‡åˆ†æ)

  # å®šæ—¶ä»»åŠ¡é…ç½®
  schedule:
    enabled: false          # æ˜¯å¦å¯ç”¨
    whitelist: []           # ç™½åå•ç¾¤åˆ—è¡¨(ä¸ºç©ºåˆ™ä¸æ‰§è¡Œ)
    minMessages: 99         # æœ€å°‘æ¶ˆæ¯æ•°
    cooldownMinutes: 60     # å†·å´æ—¶é•¿(åˆ†é’Ÿ)
    # æ‰§è¡Œæ—¶é—´: æ¯å¤© 23:59 (åœ¨ apps/report.js ä¸­é…ç½®)

  # è¯äº‘é…ç½®
  wordCloud:
    maxWords: 100           # æœ€å¤šæ˜¾ç¤ºè¯æ•°
    width: 1200             # ç”»å¸ƒå®½åº¦
    height: 800             # ç”»å¸ƒé«˜åº¦
```

## ä¾èµ–è¯´æ˜

### å¿…éœ€ä¾èµ–
- `nodejieba` - ä¸­æ–‡åˆ†è¯
- `@anthropic-ai/sdk` - Claude AI SDK (è‹¥ä½¿ç”¨ Claude)
- `marked` - Markdown è§£æ
- `yaml` - é…ç½®æ–‡ä»¶è§£æ

### å¯é€‰ä¾èµ–
- `openai` - ä½¿ç”¨ OpenAI æ—¶éœ€è¦å®‰è£…

## ä½¿ç”¨ OpenAI

å¦‚éœ€ä½¿ç”¨ OpenAI:

```bash
# å®‰è£… OpenAI SDK
cd plugins/group-insight
pnpm add openai
```

é…ç½®æ–‡ä»¶ä¿®æ”¹ä¸º:

```yaml
groupManager:
  ai:
    provider: 'openai'
    apiKey: 'sk-xxx...'
    model: 'gpt-4o'
```

## ä½¿ç”¨å›½å†…é•œåƒ/ä»£ç†

é…ç½®è‡ªå®šä¹‰ API ç«¯ç‚¹:

```yaml
groupManager:
  ai:
    provider: 'claude'
    apiKey: 'your-key'
    baseURL: 'https://your-proxy.com/v1'
```

## å¸¸è§é—®é¢˜

### nodejieba å®‰è£…å¤±è´¥

éœ€è¦ C++ ç¼–è¯‘ç¯å¢ƒ:

- **Windows**: å®‰è£… Visual Studio Build Tools
- **macOS**: `xcode-select --install`
- **Linux**: `sudo apt-get install build-essential`

å¤±è´¥åæ’ä»¶ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ç®€å•åˆ†è¯ã€‚

### AI åˆ†æå¤±è´¥

1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥(å¯èƒ½éœ€è¦ä»£ç†)
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `pnpm log`
4. ç¡®è®¤ API é¢åº¦å……è¶³

### æ¶ˆæ¯æ”¶é›†ä¸å·¥ä½œ

1. ç¡®è®¤ Redis è¿è¡Œæ­£å¸¸
2. æ£€æŸ¥é…ç½® `messageCollection.enabled: true`
3. é‡å¯ Yunzai

## æŠ€æœ¯æ¶æ„

### ç›®å½•ç»“æ„

```
plugins/group-insight/
â”œâ”€â”€ apps/              # å‘½ä»¤æ’ä»¶(çƒ­é‡è½½)
â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ components/        # æ ¸å¿ƒç»„ä»¶(é…ç½®ã€æœåŠ¡ç®¡ç†)
â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ resources/         # æ¨¡æ¿ä¸èµ„æº
â””â”€â”€ config/            # é…ç½®æ–‡ä»¶
```

### æ ¸å¿ƒç‰¹æ€§

- **Singleton æœåŠ¡ç®¡ç†** - å…¨å±€å•ä¾‹,æŒ‰éœ€åˆå§‹åŒ–
- **é…ç½®çƒ­é‡è½½** - ä¿®æ”¹é…ç½®æ— éœ€é‡å¯
- **å¹¶è¡Œ AI åˆ†æ** - 3ä¸ªåˆ†æå™¨å¹¶è¡Œæ‰§è¡Œ
- **æ™ºèƒ½é‡è¯•æœºåˆ¶** - AI è¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯•
- **ä¼˜é›…é™çº§** - éƒ¨åˆ†å¤±è´¥ä¸å½±å“æ•´ä½“æŠ¥å‘Š
- **Redis å­˜å‚¨** - æ¶ˆæ¯è‡ªåŠ¨è¿‡æœŸã€@è®°å½•ç²¾ç¡®è¿‡æœŸ

## ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: v2.0.0
- **ä½œè€…**: vsentkb
- **è®¸å¯**: MIT

## è‡´è°¢

- [TRSS-Yunzai](https://github.com/TimeRainStarSky/Yunzai) - Bot æ¡†æ¶
- [nodejieba](https://github.com/yanyiwu/nodejieba) - ä¸­æ–‡åˆ†è¯
- [Anthropic Claude](https://www.anthropic.com/) - AI æœåŠ¡

## License

MIT License
