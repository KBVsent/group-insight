# ç¾¤èŠä¿¡æ¯ç®¡ç†æ’ä»¶

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Yunzai ç¾¤èŠç®¡ç†æ’ä»¶ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- ğŸ“Œ **è°è‰¾ç‰¹æˆ‘**ï¼šæŸ¥çœ‹è°åœ¨ç¾¤é‡Œè‰¾ç‰¹äº†ä½ ï¼Œæ”¯æŒæŸ¥çœ‹å†å²è‰¾ç‰¹è®°å½•
- â˜ï¸ **è¯äº‘ç”Ÿæˆ**ï¼šåˆ†æç¾¤èŠæ¶ˆæ¯ç”Ÿæˆç²¾ç¾çš„è¯äº‘å›¾ï¼Œæ”¯æŒå½“å¤©/ä¸‰å¤©/ä¸ƒå¤©
- ğŸ¤– **AI æ€»ç»“**ï¼šä½¿ç”¨ AI æ™ºèƒ½åˆ†æå¹¶æ€»ç»“ç¾¤èŠä¸»è¦å†…å®¹å’Œè®¨è®ºè¯é¢˜

## åŠŸèƒ½ç‰¹æ€§

### 1. è°è‰¾ç‰¹æˆ‘
- ğŸ“ è‡ªåŠ¨è®°å½•æ‰€æœ‰è‰¾ç‰¹æ¶ˆæ¯
- ğŸ–¼ï¸ æ”¯æŒå›¾ç‰‡ã€è¡¨æƒ…ã€æ–‡æœ¬çš„å®Œæ•´è®°å½•
- ğŸ“¦ åˆå¹¶è½¬å‘æ¶ˆæ¯å±•ç¤ºï¼Œæ–¹ä¾¿æŸ¥çœ‹
- â° é»˜è®¤ä¿ç•™ 24 å°æ—¶

### 2. è¯äº‘ç”Ÿæˆ
- ğŸ“Š åŸºäº Puppeteer + wordcloud2.js ç”Ÿæˆ
- ğŸ”¤ æ™ºèƒ½ä¸­æ–‡åˆ†è¯ï¼ˆnodejiebaï¼‰
- ğŸš« è¿‡æ»¤åœç”¨è¯ã€è¡¨æƒ…ã€å‘½ä»¤ç­‰æ— æ„ä¹‰å†…å®¹
- ğŸ¨ ç²¾ç¾çš„æ¸å˜èƒŒæ™¯å’Œé…è‰²
- ğŸ“… æ”¯æŒå½“å¤©/ä¸‰å¤©/ä¸ƒå¤©æ—¶é—´èŒƒå›´

### 3. AI æ€»ç»“
- ğŸ¤– å¯æ’æ‹”çš„ AI æœåŠ¡æ¶æ„
- ğŸ”„ æ”¯æŒå¤šç§ AI æä¾›å•†ï¼ˆClaude / OpenAI / è‡ªå®šä¹‰ï¼‰
- ğŸ“ˆ æ™ºèƒ½åˆ†æç¾¤èŠè¯é¢˜ã€æ´»è·ƒæˆå‘˜ã€é‡è¦äº‹ä»¶
- ğŸ–¼ï¸ ç²¾ç¾çš„å¯è§†åŒ–å±•ç¤º

## å®‰è£…æ­¥éª¤

### 1. è¿›å…¥æ’ä»¶ç›®å½•
```bash
cd plugins/group-manager
```

### 2. å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨ pnpmï¼ˆæ¨èï¼‰
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install
```

### 3. é…ç½® AI API Key

å¤åˆ¶é…ç½®ç¤ºä¾‹æ–‡ä»¶ï¼š
```bash
cp config/config.example.yaml ../../config/config/group-manager.yaml
```

ç¼–è¾‘é…ç½®æ–‡ä»¶ `config/config/group-manager.yaml`ï¼š
```yaml
groupManager:
  ai:
    # åœ¨æ­¤å¡«å…¥ä½ çš„ AI API Key
    apiKey: 'your-api-key-here'

    # å¯é€‰ï¼šè‡ªå®šä¹‰ API ç«¯ç‚¹
    # baseURL: 'https://your-api-endpoint.com'
```

### 4. é‡å¯ Yunzai

```bash
# å¦‚æœä½¿ç”¨ PM2
pnpm restart

# å¦‚æœä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹
node . stop
node . daemon

# æˆ–è€…ç›´æ¥é‡å¯
node .
```

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `è°è‰¾ç‰¹æˆ‘` / `è°@æˆ‘` | æŸ¥çœ‹è°è‰¾ç‰¹äº†ä½  | è°è‰¾ç‰¹æˆ‘ |
| `#è¯äº‘` / `#ç¾¤èŠè¯äº‘` | ç”Ÿæˆå½“å¤©è¯äº‘ | #è¯äº‘ |
| `#è¯äº‘ ä¸‰å¤©` | ç”Ÿæˆä¸‰å¤©å†…è¯äº‘ | #è¯äº‘ ä¸‰å¤© |
| `#è¯äº‘ ä¸ƒå¤©` | ç”Ÿæˆä¸ƒå¤©å†…è¯äº‘ | #è¯äº‘ ä¸ƒå¤© |
| `#ç¾¤èŠæ€»ç»“` / `#æ€»ç»“` | AI æ€»ç»“å½“å¤©ç¾¤èŠ | #æ€»ç»“ |
| `#æ€»ç»“ ä¸‰å¤©` | AI æ€»ç»“ä¸‰å¤©å†…ç¾¤èŠ | #æ€»ç»“ ä¸‰å¤© |
| `#æ€»ç»“ ä¸ƒå¤©` | AI æ€»ç»“ä¸ƒå¤©å†…ç¾¤èŠ | #æ€»ç»“ ä¸ƒå¤© |
| `#æ¸…é™¤è‰¾ç‰¹æ•°æ®` | æ¸…é™¤è‡ªå·±çš„è‰¾ç‰¹è®°å½• | #æ¸…é™¤è‰¾ç‰¹æ•°æ® |
| `#æ¸…é™¤å…¨éƒ¨è‰¾ç‰¹æ•°æ®` | [ä¸»äºº] æ¸…é™¤æ‰€æœ‰è‰¾ç‰¹è®°å½• | #æ¸…é™¤å…¨éƒ¨è‰¾ç‰¹æ•°æ® |

### ä½¿ç”¨ç¤ºä¾‹

1. **æŸ¥çœ‹è°è‰¾ç‰¹äº†æˆ‘**
   ```
   ç”¨æˆ·: è°è‰¾ç‰¹æˆ‘
   æœºå™¨äºº: [è¿”å›åˆå¹¶è½¬å‘æ¶ˆæ¯ï¼ŒåŒ…å«æ‰€æœ‰è‰¾ç‰¹è®°å½•]
   ```

2. **ç”Ÿæˆè¯äº‘**
   ```
   ç”¨æˆ·: #è¯äº‘ ä¸‰å¤©
   æœºå™¨äºº: æ­£åœ¨ç”Ÿæˆä¸‰å¤©çš„è¯äº‘ï¼Œè¯·ç¨å€™...
   æœºå™¨äºº: [è¿”å›è¯äº‘å›¾ç‰‡]
   ```

3. **AI æ€»ç»“**
   ```
   ç”¨æˆ·: #æ€»ç»“ å½“å¤©
   æœºå™¨äºº: æ­£åœ¨ä½¿ç”¨ AI åˆ†æå½“å¤©çš„ç¾¤èŠå†…å®¹ï¼Œè¯·ç¨å€™...
   æœºå™¨äºº: [è¿”å›ç²¾ç¾çš„æ€»ç»“æŠ¥å‘Šå›¾ç‰‡]
   ```

## é…ç½®è¯´æ˜

### å®Œæ•´é…ç½®ç¤ºä¾‹

åœ¨ `config/config/group-manager.yaml` ä¸­å¯ä»¥è‡ªå®šä¹‰ä»¥ä¸‹é…ç½®ï¼š

```yaml
groupManager:
  # æ¶ˆæ¯ä¿ç•™å¤©æ•°
  retentionDays: 7

  # è‰¾ç‰¹è®°å½•ä¿ç•™æ—¶é—´ï¼ˆå°æ—¶ï¼‰
  atRetentionHours: 24

  # AI é…ç½®
  ai:
    # AI æä¾›å•†: claude / openai
    provider: 'claude'

    # API Key
    apiKey: 'your-api-key-here'

    # æ¨¡å‹åç§°
    model: 'claude-3-5-sonnet-20241022'

    # è‡ªå®šä¹‰ API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
    baseURL: ''

    # è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    timeout: 60000

    # æœ€å¤§ Token æ•°
    maxTokens: 2000

  # è¯äº‘é…ç½®
  wordCloud:
    # æœ€å¤šæ˜¾ç¤ºè¯æ•°
    maxWords: 100

    # æœ€çŸ­è¯é•¿åº¦
    minLength: 2

    # æœ€å°è¯é¢‘
    minFrequency: 2

    # ç”»å¸ƒå°ºå¯¸
    width: 1200
    height: 800

    # èƒŒæ™¯é¢œè‰²
    backgroundColor: '#ffffff'

  # æ¶ˆæ¯æ”¶é›†é…ç½®
  messageCollection:
    # æ˜¯å¦å¯ç”¨æ¶ˆæ¯æ”¶é›†
    enabled: true

    # æ˜¯å¦æ”¶é›†å›¾ç‰‡
    collectImages: false

    # æ˜¯å¦æ”¶é›†è¡¨æƒ…
    collectFaces: false

    # æœ€å¤§æ¶ˆæ¯é•¿åº¦
    maxMessageLength: 500
```

### åˆ‡æ¢ AI æä¾›å•†

#### ä½¿ç”¨ Claudeï¼ˆé»˜è®¤ï¼‰

```yaml
groupManager:
  ai:
    provider: 'claude'
    apiKey: 'sk-ant-xxx...'
    model: 'claude-3-5-sonnet-20241022'
```

#### ä½¿ç”¨ OpenAI

å…ˆå®‰è£… OpenAI SDKï¼š
```bash
cd plugins/group-manager
pnpm add openai
```

ç„¶åä¿®æ”¹é…ç½®ï¼š
```yaml
groupManager:
  ai:
    provider: 'openai'
    apiKey: 'sk-xxx...'
    model: 'gpt-4o'
```

#### ä½¿ç”¨å›½å†…é•œåƒ

å¦‚æœä½¿ç”¨å›½å†… API ä¸­è½¬æœåŠ¡ï¼Œå¯ä»¥é…ç½® baseURLï¼š
```yaml
groupManager:
  ai:
    provider: 'claude'
    apiKey: 'your-key'
    baseURL: 'https://your-proxy-service.com/v1'
```

## ä¾èµ–è¯´æ˜

### å¿…éœ€ä¾èµ–
- **nodejieba** (^2.6.0) - ä¸­æ–‡åˆ†è¯
- **@anthropic-ai/sdk** (^0.32.1) - Claude AI SDK
- **marked** (^12.0.0) - Markdown è§£æ
- **yaml** (^2.4.0) - YAML é…ç½®è§£æ

### å¯é€‰ä¾èµ–
- **openai** - å¦‚æœä½¿ç”¨ OpenAI ä½œä¸º AI æä¾›å•†

## å¸¸è§é—®é¢˜

### 1. ä¾èµ–å®‰è£…å¤±è´¥

å¦‚æœ `pnpm install` å¤±è´¥ï¼Œå°è¯•ï¼š

```bash
# æ¸…é™¤ç¼“å­˜
pnpm store prune

# ä½¿ç”¨ npm å®‰è£…
npm install
```

### 2. nodejieba å®‰è£…å¤±è´¥

nodejieba æ˜¯ C++ æ‰©å±•ï¼Œå¯èƒ½éœ€è¦ç¼–è¯‘ç¯å¢ƒï¼š

**Windows:**
- å®‰è£… Visual Studio Build Tools
- æˆ–ä½¿ç”¨ windows-build-tools: `npm install -g windows-build-tools`

**macOS:**
```bash
xcode-select --install
```

**Linux:**
```bash
sudo apt-get install build-essential
```

å¦‚æœä»ç„¶æ— æ³•å®‰è£…ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ç®€å•åˆ†è¯ã€‚

### 3. è¯äº‘ä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå¼‚å¸¸

1. æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦è¶³å¤Ÿï¼ˆè‡³å°‘éœ€è¦ä¸€å®šé‡çš„ä¸­æ–‡æ¶ˆæ¯ï¼‰
2. æ£€æŸ¥ Puppeteer æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. æŸ¥çœ‹æ—¥å¿—ï¼š`pnpm log`

### 4. AI æ€»ç»“å¤±è´¥

1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®é…ç½®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆå¯èƒ½éœ€è¦ä»£ç†ï¼‰
3. æ£€æŸ¥ API é¢åº¦æ˜¯å¦å……è¶³
4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

### 5. æ¶ˆæ¯æ”¶é›†ä¸å·¥ä½œ

1. ç¡®è®¤ Redis æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥é…ç½®ä¸­ `messageCollection.enabled` æ˜¯å¦ä¸º `true`
3. é‡å¯ Yunzai

## æ•°æ®å­˜å‚¨

### Redis é”®ç»“æ„

```
Yz:groupManager:msg:{ç¾¤å·}:{æ—¥æœŸ}       # æ¶ˆæ¯å†å²
Yz:groupManager:at:{ç¾¤å·}_{ç”¨æˆ·ID}      # è‰¾ç‰¹è®°å½•
```

### æ¸…ç†æ•°æ®

å¦‚éœ€æ‰‹åŠ¨æ¸…ç†æ•°æ®ï¼Œå¯åœ¨ Redis ä¸­æ‰§è¡Œï¼š

```bash
# æ¸…ç†æ‰€æœ‰ç¾¤èŠç®¡ç†æ•°æ®
redis-cli KEYS "Yz:groupManager:*" | xargs redis-cli DEL

# åªæ¸…ç†æŸä¸ªç¾¤çš„æ•°æ®
redis-cli KEYS "Yz:groupManager:*:ç¾¤å·*" | xargs redis-cli DEL
```

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-11-01)

- âœ¨ åˆå§‹ç‰ˆæœ¬
- âœ… å®ç°è°è‰¾ç‰¹æˆ‘åŠŸèƒ½
- âœ… å®ç°è¯äº‘ç”ŸæˆåŠŸèƒ½
- âœ… å®ç° AI æ€»ç»“åŠŸèƒ½
- âœ… æ”¯æŒå¤šç§ AI æä¾›å•†
- âœ… ç²¾ç¾çš„å¯è§†åŒ–å±•ç¤º

## å¼€å‘è€…

- **ä½œè€…**: vsentkb
- **ç‰ˆæœ¬**: 1.0.0
- **è®¸å¯**: MIT

## å‚ä¸è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è‡´è°¢

- [TRSS-Yunzai](https://github.com/TimeRainStarSky/Yunzai) - Bot æ¡†æ¶
- [nodejieba](https://github.com/yanyiwu/nodejieba) - ä¸­æ–‡åˆ†è¯
- [wordcloud2.js](https://github.com/timdream/wordcloud2.js) - è¯äº‘ç”Ÿæˆ
- [Anthropic Claude](https://www.anthropic.com/) - AI æœåŠ¡

## License

MIT License
